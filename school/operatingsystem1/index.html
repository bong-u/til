<!doctype html><html>
<head>
<title> Bong-u's TIL </title>
<meta charset=utf-8>
<meta property="og:title" content="Bong-u's til">
<meta property="og:type" content="blog">
<meta property="og:url" content="https://github.com/bong-u/til-hugo">
<meta property="og:image" content="https://bong-u.github.io/til/asset/profile.jpg">
<script type=text/javascript src=https://bong-u.github.io/til/src/script.js></script>
<link rel=icon href=https://bong-u.github.io/til/favicon16.png sizes=16x16>
<link rel=icon href=https://bong-u.github.io/til/favicon32.png sizes=32x32>
<link id=twCSS rel=stylesheet href=https://bong-u.github.io/til/src/style.css>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$']], displayMath: [['$$','$$']]},
  });
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HE9FQR1ML7"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-HE9FQR1ML7')</script>
</head>
<body class="flex justify-center my-16">
<header class="absolute top-0 right-0 p-4 z-10 flex items-center gap-3 text-3xl">
<a href=https://bong-u.github.io/til/>ğŸ </a>
<a href=https://github.com/bong-u/til>ğŸˆ</a>
<input type=checkbox id=toggleDarkMode onchange=toggleDarkModeHandler() hidden>
<label class=cursor-pointer for=toggleDarkMode>
<span id=toggleButton>â˜€ï¸</span>
</label>
</header>
<script>let anchorsCache=null;document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("scroll",()=>{const c=document.getElementById("TableOfContents"),b=document.querySelectorAll("#TableOfContents a"),a=getCurrentAnchor();let d=0;for(let c=0;c<b.length;c++)b[c].classList.remove("current"),b[c]===a&&(d=c);a&&a.classList.add("current"),c.scroll(0,a.offsetTop-c.offsetHeight/2)})});const getTocItem=a=>document.querySelector('[href="'+a+'"]'),getCurrentAnchor=()=>{const c=window.pageYOffset,a=getAnchors();let b=null;for(let d=0;d<a.length;d++){const e=getHeading(a[d]).getBoundingClientRect().top+c;if(e<c+window.innerHeight*.23)b=a[d];else break}return b||(b=a[0]),getTocItem(b)},getAnchors=()=>(anchorsCache||(anchorsCache=Array.from(document.querySelectorAll("#TableOfContents a")).map(a=>a.getAttribute("href"))),anchorsCache),getHeading=a=>document.getElementById(a.substr(1))</script>
<aside class="fixed top-0 right-0 py-16 w-2/12 gap-3 mx-9 hidden lg:flex text-sm overflow-hidden">
<nav id=TableOfContents>
<ul>
<li><a href=#ìš´ì˜ì²´ì œ-ê°œìš”>ìš´ì˜ì²´ì œ ê°œìš”</a>
<ul>
<li><a href=#ìš´ì˜ì²´ì œì˜-ì—­í• >ìš´ì˜ì²´ì œì˜ ì—­í• </a></li>
<li><a href=#ìš´ì˜ì²´ì œì˜-ë°œì „>ìš´ì˜ì²´ì œì˜ ë°œì „</a></li>
<li><a href=#ìš´ì˜ì²´ì œì˜-êµ¬ì„±-ìš”ì†Œ>ìš´ì˜ì²´ì œì˜ êµ¬ì„± ìš”ì†Œ</a></li>
<li><a href=#os-architecture>OS Architecture</a></li>
</ul>
</li>
<li><a href=#process>Process</a>
<ul>
<li><a href=#processë€>Processë€</a></li>
<li><a href=#trace-of-processes>Trace of Processes</a></li>
<li><a href=#process-state-model>Process state model</a></li>
<li><a href=#process-control-block>Process Control block</a></li>
<li><a href=#process-context>Process Context</a></li>
<li><a href=#virtual-address-space>Virtual Address Space</a></li>
<li><a href=#process-creation>Process Creation</a></li>
<li><a href=#process-switch>Process switch</a></li>
<li><a href=#process-termination>Process Termination</a></li>
<li><a href=#inter-process-communication-ipc>Inter-Process Communication (IPC)</a></li>
</ul>
</li>
<li><a href=#threads>Threads</a>
<ul>
<li><a href=#processì™€-threadì˜-ì°¨ì´>Processì™€ Threadì˜ ì°¨ì´</a></li>
<li><a href=#threadë€>Threadë€</a></li>
<li><a href=#threadì˜-ì¥ì >Threadì˜ ì¥ì </a></li>
<li><a href=#user-level-threads>User-Level Threads</a></li>
<li><a href=#kernel-level-threads>Kernel-Level Threads</a></li>
</ul>
</li>
<li><a href=#mutual-exclusion-and-synchronization>Mutual Exclusion and Synchronization</a>
<ul>
<li><a href=#key-terms-in-concurrency>Key terms in Concurrency</a></li>
<li><a href=#producerconsumer--finite-buffer>Producer/Consumer : Finite Buffer</a></li>
<li><a href=#race-condition-in-a-uniprocessor>Race Condition in a Uniprocessor</a></li>
<li><a href=#race-condition-in-one-process>Race Condition in one Process</a></li>
<li><a href=#prevent-race-condition-sw-solution>Prevent Race Condition (<strong>SW solution</strong>)</a></li>
<li><a href=#test-and-set-instruction-hw-solution>Test and Set Instruction (<strong>HW solution</strong>)</a></li>
<li><a href=#semaphore-hw-solution>Semaphore (<strong>HW solution</strong>)</a></li>
</ul>
</li>
<li><a href=#deadlock>Deadlock</a>
<ul>
<li><a href=#deadlockì´ë€>Deadlockì´ë€</a></li>
<li><a href=#deadlockì˜-ì¡°ê±´ì„-í•˜ë‚˜ì”©-ê¹¨ë³´ì>Deadlockì˜ ì¡°ê±´ì„ í•˜ë‚˜ì”© ê¹¨ë³´ì</a></li>
<li><a href=#í•´ê²°ë°©ë²•>í•´ê²°ë°©ë²•</a></li>
</ul>
</li>
<li><a href=#file-management>File Management</a>
<ul>
<li><a href=#fcb>FCB</a></li>
<li><a href=#device-file>Device file</a></li>
</ul>
</li>
</ul>
</nav>
<div onclick=scrollToTop() class="fixed p-5 right-0 bottom-0 text-center text-2xl cursor-pointer hover-bold">
ğŸ›†
</div>
</aside>
<main class="flex w-full justify-center">
<section class="px-4 w-11/12 lg:w-1/2 xl:w-7/12">
<div class="mb-10 whitespace-nowrap">
<div class="flex justify-between items-baseline my-4 gap-8">
<h1 id=title class="overflow-ellipsis-bundle text-3xl font-bold p-1">
ìš´ì˜ì²´ì œ - ì¤‘ê°„ë²”ìœ„
</h1>
<div class="flex flex-col items-end">
<h4 id=date> CREATED 2023-03-06 </h4>
<h4 id=date> MODIFIED 2023-05-29</h4>
</div>
</div>
</div>
<article id=content class="bg-inherit markdown-body flex flex-col">
<h2 id=ìš´ì˜ì²´ì œ-ê°œìš”>ìš´ì˜ì²´ì œ ê°œìš”</h2>
<h3 id=ìš´ì˜ì²´ì œì˜-ì—­í• >ìš´ì˜ì²´ì œì˜ ì—­í• </h3>
<ul>
<li>Program execution</li>
<li>Access to computer resources (I/O device, Data&mldr;)</li>
<li>Error detection and response</li>
<li>Accounting (ex: task manager)</li>
</ul>
<h3 id=ìš´ì˜ì²´ì œì˜-ë°œì „>ìš´ì˜ì²´ì œì˜ ë°œì „</h3>
<ul>
<li>
<p>Serial Processing : No OS, No Job scheduling</p>
</li>
<li>
<p>Simple batch system</p>
<ul>
<li>OSê°€ jobì„ í• ë‹¹</li>
<li>Controlled by monitor</li>
</ul>
</li>
<li>
<p>Uni-programming</p>
<ul>
<li>ë‹¤ ì‹¤í–‰ë ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼</li>
<li>bad utilization</li>
</ul>
</li>
<li>
<p>Multiprogramming</p>
<ul>
<li>The processor can switch to the other job</li>
<li>better utilization, needs more memory</li>
</ul>
</li>
<li>
<p>Time sharing</p>
<ul>
<li>proceessì—ê²Œ ì •í•´ì§„ time slice (time quantum)ê°€ ì£¼ì–´ì§„ë‹¤.</li>
<li>better utilization, bad throughput</li>
</ul>
</li>
<li>
<p>Symmetric multiprocessing (SMP)</p>
<ul>
<li>ì—¬ëŸ¬ processorsê°€ main memory, I/O ì¥ì¹˜ë“¤ì„ ê³µìœ </li>
<li>ì—¬ëŸ¬ processorsê°€ ë™ì¼í•œ function ìˆ˜í–‰ ê°€ëŠ¥</li>
</ul>
</li>
</ul>
<h3 id=ìš´ì˜ì²´ì œì˜-êµ¬ì„±-ìš”ì†Œ>ìš´ì˜ì²´ì œì˜ êµ¬ì„± ìš”ì†Œ</h3>
<ul>
<li>Distributed Systems (ë¶„ì‚°ì‹œìŠ¤í…œ)
<ul>
<li>ì—¬ëŸ¬ ì»´í“¨í„°ë¥¼ ì—°ê²°í•´ ì‚¬ìš©</li>
<li>ë¹ ë¥¸ ì†ë„, ë†’ì€ ë°ì´í„° ê°€ìš©ì„±</li>
</ul>
</li>
</ul>
<ul>
<li>Command-Interpreter System
<ul>
<li>userê°€ ì§ì ‘ OSì—ê²Œ ì¼ì„ ì‹œí‚¨ë‹¤</li>
</ul>
</li>
</ul>
<h3 id=os-architecture>OS Architecture</h3>
<ul>
<li>Monolithic kernel
<ul>
<li>ëª¨ë“  OSì˜ ê¸°ëŠ¥ì„ í•˜ë‚˜ì˜ kernelì´ ê°€ì§€ê³  ìˆëŠ”ë‹¤</li>
<li>í•˜ë‚˜ ìˆ˜ì •í•˜ë©´ ì „ì²´ë¥¼ ì»´íŒŒì¼ í•´ì•¼ í•œë‹¤</li>
</ul>
</li>
<li>Microkernel kernel
<ul>
<li>kernel ë‚´ì— í•„ìš”í•œ ê¸°ëŠ¥
<blockquote>
<p>Address space management, Interprocess communication, ê¸°ë³¸ì ì¸ í”„ë¡œì„¸ìŠ¤ scheduling ê¸°ëŠ¥</p>
</blockquote>
</li>
<li>kernelê°„ í†µì‹ ì†ë„ê°€ ëŠë¦¬ë‹¤</li>
</ul>
</li>
</ul>
<h2 id=process>Process</h2>
<h3 id=processë€>Processë€</h3>
<ul>
<li>ì»´í“¨í„°ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ê°ì²´</li>
<li>register ì¤‘ PCê°€ contextë¥¼ ê°€ë¦¬í‚¨ë‹¤</li>
<li>ContextëŠ” dataì™€ codeë¡œ êµ¬ì„±</li>
</ul>
<h3 id=trace-of-processes>Trace of Processes</h3>
<ul>
<li>A -> time out -> B -> I/O request -> A</li>
<li>ì‚¬ì´ì‚¬ì´ì— dispatcherê°€ processorì— processë¥¼ êµì²´í•œë‹¤</li>
</ul>
<h3 id=process-state-model>Process state model</h3>
<p><img src=/static/image/os_process_states.png alt=process_states></p>
<ul>
<li>Process suspensionì˜ ì´ìœ 
<ul>
<li>Swapping : memory ê³µê°„ í™•ë³´ë¥¼ ìœ„í•´</li>
<li>Timing : ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œê·¸ë¨</li>
<li>Interactive user request : userì˜ ìš”ì²­</li>
<li>Parent process request : parent processì˜ ìš”ì²­</li>
</ul>
</li>
</ul>
<h3 id=process-control-block>Process Control block</h3>
<ul>
<li>êµ¬ì„±ìš”ì†Œ : Identifier, State, Priority, PC, Memory pointers, Address of memory context, I/O state info, Accounting info</li>
<li>Process 1ê°œ ë‹¹ PCB 1ê°œ</li>
</ul>
<h3 id=process-context>Process Context</h3>
<ul>
<li><strong>User Context : code, data, user stack</strong></li>
<li><strong>System Context : kernel stack, PCB</strong></li>
</ul>
<h3 id=virtual-address-space>Virtual Address Space</h3>
<blockquote>
<p>í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ë©´ ì„œ ì ‘ê·¼(access, reference) ê°€ëŠ¥í•œ ì£¼ì†Œë“¤ì˜ ë²”ìœ„</p>
</blockquote>
<ul>
<li>
<p>32bit address computer : $2^{32}$ = 4G ë²ˆì§€, 3G~4Gë²ˆì§€ì—ëŠ” ì»¤ë„ì´ ë“¤ì–´ê°„ë‹¤</p>
</li>
<li>
<p>ë³´ì¡°ê¸°ì–µì¥ì¹˜ì˜ VASëŠ” í”„ë¡œì„¸ìŠ¤ ê°œìˆ˜ë§Œí¼ ì¡´ì¬</p>
</li>
<li>
<p>êµ¬ì„±</p>
<pre tabindex=0><code>| kernel
| stack (local var)
| bss  (ë§Œë“¤ë•Œ ì´ˆê¸°í™” ì•ˆ í•œ global var)

| data (ë§Œë“¤ë•Œ ì´ˆê¸°í™” í•œ global var)
| code
</code></pre></li>
</ul>
<h3 id=process-creation>Process Creation</h3>
<ul>
<li>
<p>Processê°€ ìƒì„±ë˜ëŠ” ê²½ìš°</p>
<ol>
<li>OSê°€ ë§Œë“œëŠ” ê²½ìš°</li>
<li>ì‹¤í–‰ ì¤‘ì¸ processê°€ ìì‹ì„ ë§Œë“œëŠ” ê²½ìš°</li>
<li>User command</li>
</ol>
</li>
<li>
<p>fork()</p>
<ol>
<li>ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ memory infotableì´ ë¶€ëª¨ì˜ contextë¥¼ ê°€ë¦¬í‚¤ê²Œ í•œë‹¤</li>
<li>memoryë‚´ì—ì„œ ë¶€ëª¨ì˜ data, stackì„ ë³µì œí•œë‹¤</li>
<li>ìì‹ì´ ê°€ë¦¬í‚¤ëŠ” ê²ƒì„ ë³µì œëœ contextë¡œ ë°”ê¾¼ë‹¤</li>
</ol>
<ul>
<li>COW(Copy on write) : ë³µì‚¬ë¥¼ ëŠ¦ì¶¤ìœ¼ë¡œì„œ ë©”ëª¨ë¦¬ ì ˆì•½</li>
</ul>
</li>
</ul>
<h3 id=process-switch>Process switch</h3>
<ul>
<li>Mode change : Memory ë‚´ì—ì„œ user mode &lt;-> system mode</li>
<li>Context change : ë‹¤ë¥¸ processë¡œ switch</li>
</ul>
<ul>
<li>
<p>Context changeë¥¼ í•˜ëŠ” ê²½ìš°</p>
<ul>
<li>Processì˜ ì†Œë©¸ : Running -> Release</li>
<li>Processì˜ block (I/O request, file open, page fault) : Running -> Blocked</li>
<li>Expiration of time slice : Running -> Ready</li>
<li>I/O interrupt : Blocked -> Ready</li>
</ul>
</li>
<li>
<p>Steps of context switch</p>
<ol>
<li>Save context(pc, other register) of processor</li>
<li>Update the PCB</li>
<li>Move PCB to appropriate queue</li>
<li>Select another process to execute</li>
<li>Update the PCB</li>
<li>Update memory-management data structures</li>
<li>Restore context of the selected process</li>
</ol>
</li>
</ul>
<h3 id=process-termination>Process Termination</h3>
<ul>
<li>Processê°€ ì‚­ì œë˜ëŠ” ê²½ìš°
<ol>
<li>Normal ompletion</li>
<li>Parent request</li>
<li>Protection error : ë¹„ì •ìƒì ì¸ ì ‘ê·¼ì„ í• ë•Œ OSê°€ ê°•ì œ ì¢…ë£Œ</li>
<li>Arithmetic Error, Invalid instruction&mldr;</li>
</ol>
</li>
</ul>
<ul>
<li>terminated ìƒíƒœ : Computer resourceëŠ” ëºê²¼ì§€ë§Œ, PCBëŠ” ë‚¨ì•„ìˆëŠ” ìƒíƒœ</li>
<li>í•´ë‹¹ í”„ë¡œì„¸ì„œì˜ ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ê°€ wait syscallì„ í˜¸ì¶œí•˜ë©´ ì™„ì „íˆ ì‚­ì œ</li>
<li>ì§€ì›Œì§€ëŠ” ë¶€ëª¨ ë°‘ì— ìì‹ì´ ë‚¨ì•„ìˆë‹¤ë©´ ìì‹ë“¤ì„ init í”„ë¡œì„¸ìŠ¤ì˜ ì–‘ìë¡œ ë³´ë‚¸ë‹¤</li>
</ul>
<h3 id=inter-process-communication-ipc>Inter-Process Communication (IPC)</h3>
<ol>
<li>Message Passing : kernelë‚´ mailboxë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ëŠ” ë°©ë²•
<ul>
<li>user mode -> kernel mode -> user mode</li>
<li>êµ¬í˜„ì´ ì‰½ë‹¤, ëŠë¦¬ë‹¤</li>
</ul>
</li>
<li>Shared Memory
<ul>
<li>VADì— shared memoryë²• ì£¼ì†Œë¥¼ ê°–ê³ ìˆë‹¤</li>
<li>ë¹ ë¥´ë‹¤, êµ¬í˜„ì´ ì–´ë µë‹¤</li>
</ul>
</li>
</ol>
<ul>
<li>Message / Signal</li>
</ul>
<h2 id=threads>Threads</h2>
<h3 id=processì™€-threadì˜-ì°¨ì´>Processì™€ Threadì˜ ì°¨ì´</h3>
<h3 id=threadë€>Threadë€</h3>
<ul>
<li>
<p>A unit of execution of in a process</p>
</li>
<li>
<p>has an execution state</p>
</li>
<li>
<p>êµ¬ì„± ìš”ì†Œ</p>
<ul>
<li>Stack</li>
<li>Memory for registers context : thread control block</li>
</ul>
</li>
<li>
<p>multithread</p>
<p><img src=/static/image/os_multithread.png alt=multi_thread></p>
</li>
</ul>
<h3 id=threadì˜-ì¥ì >Threadì˜ ì¥ì </h3>
<ol>
<li>Process ë§Œë“œëŠ”ê±° ë³´ë‹¤ Thread ë§Œë“œëŠ”ê²Œ ë¹ ë¥´ë‹¤</li>
<li>Process ì—†ì• ëŠ”ê±° ë³´ë‹¤ Thread ì—†ì• ëŠ”ê²Œ ë¹ ë¥´ë‹¤</li>
<li>Processë¼ë¦¬ í†µì‹ í•˜ëŠ”ê±°ë³´ë‹¤ Threadë¼ë¦¬ í†µì‹ ì´ ë” ë¹ ë¥´ë‹¤ (data ê³µìœ )</li>
</ol>
<h3 id=user-level-threads>User-Level Threads</h3>
<ul>
<li>mode changeê°€ í•„ìš”ì—†ë‹¤</li>
<li>userê°€ control í•  ìˆ˜ ìˆë‹¤</li>
<li>í•˜ë‚˜ê°€ blockë˜ë©´ ë‚˜ë¨¸ì§€ë„ block (kernel ì…ì¥ì—ì„œ 1ê°œì˜ thread)</li>
</ul>
<h3 id=kernel-level-threads>Kernel-Level Threads</h3>
<ul>
<li>kernelì— ì¢…ì†ì ì´ë‹¤</li>
<li>kernelì´ ê°œë³„ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤</li>
</ul>
<h2 id=mutual-exclusion-and-synchronization>Mutual Exclusion and Synchronization</h2>
<h3 id=key-terms-in-concurrency>Key terms in Concurrency</h3>
<ul>
<li>Race condition : ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ë•Œ</li>
<li>Mutual exclusion : í•œ í”„ë¡œì„¸ìŠ¤ê°€ ê³µìœ ëœ dataë¥¼ accessí• ë•Œ, ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ê±´ë“œë¦¬ë©´ ì•ˆëœë‹¤ëŠ” ì„±ì§ˆ</li>
<li>Critical section : ê³µìœ ëœ resourceë¥¼ accessí•˜ëŠ” ë¶€ë¶„ì˜ ì½”ë“œ</li>
</ul>
<ul>
<li>Starvation : Processì—ê²Œ ìì›ì´ ë°°ì •ë˜ì§€ ì•ŠëŠ” ê²½ìš°</li>
<li>Deadlock : Starvation for infinite duration</li>
</ul>
<h3 id=producerconsumer--finite-buffer>Producer/Consumer : Finite Buffer</h3>
<ul>
<li>
<p>producer</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>item v;


<span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>) {
  <span style=color:#66d9ef>while</span> (counter <span style=color:#f92672>==</span> BUFFER_SIZE) ; <span style=color:#75715e>// busy waiting
</span><span style=color:#75715e></span>  <span style=color:#75715e>/* produce item v */</span>
  b[in] <span style=color:#f92672>=</span> v;
  in <span style=color:#f92672>=</span> (in <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> BUFFER_SIZE;
  counter<span style=color:#f92672>++</span>;
}
</code></pre></div></li>
<li>
<p>consumer</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>item w;
<span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>) {
  <span style=color:#66d9ef>while</span> (counter <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) ; <span style=color:#75715e>// busy waiting
</span><span style=color:#75715e></span>  w <span style=color:#f92672>=</span> b[out];
  out <span style=color:#f92672>=</span> (out <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> BUFFER_SIZE;
  counter<span style=color:#f92672>--</span>;
  <span style=color:#75715e>/* consume item w */</span>
}
</code></pre></div></li>
<li>
<p>=> Race condition ë°œìƒ ê°€ëŠ¥</p>
</li>
</ul>
<h3 id=race-condition-in-a-uniprocessor>Race Condition in a Uniprocessor</h3>
<ul>
<li>counter++, counter&ndash;ì™€ ê°™ì€ êµ¬ë¬¸ì€ assemblyë¡œ ë°”ë€Œë©´ 1ê°œì´ìƒì˜ instructionì´ë‹¤.</li>
<li>ì¤‘ê°„ì— interruptê°€ ë°œìƒí•˜ë©´ race conditionì´ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ atomicí•˜ê²Œ ì‹¤í–‰ë˜ì–´ì•¼í•œë‹¤.</li>
</ul>
<h3 id=race-condition-in-one-process>Race Condition in one Process</h3>
<ul>
<li>Multithreadingì—ì„œë„ race conditionì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</li>
</ul>
<h3 id=prevent-race-condition-sw-solution>Prevent Race Condition (<strong>SW solution</strong>)</h3>
<ul>
<li>ì¡°ê±´</li>
</ul>
<ol>
<li>Mutual Exclusion : critical sectionì— í•˜ë‚˜ê°€ ì ‘ê·¼ ì¤‘ì´ë©´ ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì ‘ê·¼ ë¶ˆê°€</li>
<li>Progress : ì•„ë¬´ë„ ì—†ìœ¼ë©´ ì ‘ê·¼ ê°€ëŠ¥</li>
<li>Bounded Waiting : ê¸°ë‹¤ë¦¬ëŠ” ë° í•œê³„ ì¡´ì¬ (P1 -> P3 -> P1 -> P3 .., P2ëŠ”?)</li>
</ol>
<ul>
<li>
<p>ë°©ë²• 1</p>
<ul>
<li>P0
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>do</span> {
  <span style=color:#66d9ef>while</span> (turn <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) ;
  <span style=color:#75715e>/* critical section */</span>
  turn <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
  <span style=color:#75715e>/* remainder section */</span>
} <span style=color:#66d9ef>while</span> (true);
</code></pre></div></li>
<li>P1
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>do</span> {
  <span style=color:#66d9ef>while</span> (turn <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>) ;
  <span style=color:#75715e>/* critical section */</span>
  turn <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  <span style=color:#75715e>/* remainder section */</span>
} <span style=color:#66d9ef>while</span> (true);
</code></pre></div></li>
<li>P0ì—ì„œ turn = 1ì„ ì‹¤í–‰í•˜ê¸° ì „ì— interruptê°€ ë°œìƒí•˜ë©´, P1ë„ ì ‘ê·¼ ë¶ˆê°€</li>
<li>-> progress ì„±ì§ˆ ë§Œì¡± X</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>ë°©ë²• 2 (Peterson&rsquo;s Algorithm)</p>
<ul>
<li>P0
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>do</span> {
  flag[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> true;
  turn <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
  <span style=color:#66d9ef>while</span> (flag [<span style=color:#ae81ff>1</span>] <span style=color:#f92672>&amp;&amp;</span> turn <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) ;
  <span style=color:#75715e>/* critical section */</span>
  flag[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> false;
  <span style=color:#75715e>/* remainder section */</span>
} <span style=color:#66d9ef>while</span> (true);
</code></pre></div></li>
</ul>
<ul>
<li>P1
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>do</span> {
  flag[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> true;
  turn <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  <span style=color:#66d9ef>while</span> (flag [<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&amp;&amp;</span> turn <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) ;
  <span style=color:#75715e>/* critical section */</span>
  flag[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> false;
  <span style=color:#75715e>/* remainder section */</span>
} <span style=color:#66d9ef>while</span> (true);
</code></pre></div></li>
<li>ëª¨ë“  ì¡°ê±´ ë§Œì¡±</li>
<li>í”„ë¡œì„¸ìŠ¤ 2ê°œì¼ë•Œë§Œ ì ìš© ê°€ì—¬</li>
</ul>
</li>
<li>
<p>ë°©ë²• 3 (Bakery Algorithm)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>do</span> {
  <span style=color:#75715e>// numberë¥¼ ë¶€ì—¬ë°›ëŠ” ê³¼ì •ì€ atomic í•˜ì§€ ì•Šë‹¤
</span><span style=color:#75715e></span>  choosing[i] <span style=color:#f92672>=</span> true
  <span style=color:#75715e>// ê°€ì¥ í° ë²ˆí˜¸ + 1ì„ ë¶€ì—¬
</span><span style=color:#75715e></span>  number[i] <span style=color:#f92672>=</span> max(number[<span style=color:#ae81ff>0</span>], number[<span style=color:#ae81ff>1</span>], ..., number[n<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
  choosing[i] <span style=color:#f92672>=</span> false;

  <span style=color:#66d9ef>for</span> (j<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; j<span style=color:#f92672>&lt;</span>n; j<span style=color:#f92672>++</span>) {
    <span style=color:#75715e>// ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ choosing ì¤‘ì¸ì§€ ì²´í¬
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>while</span> (choosing[i]);

    <span style=color:#75715e>// ìì‹ ì´ ë²ˆí˜¸ë¥¼ ë°›ì•˜ëŠ”ì§€, ë°œê¸‰ ë°›ì€ ë²ˆí˜¸ê°€ 1ìˆœìœ„ì¸ì§€ ì²´í¬
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>while</span> ((number[i] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&amp;&amp;</span> (number[j], j) <span style=color:#f92672>&lt;</span> (number[i], i)) ;
  }

  <span style=color:#75715e>/* critical section */</span>

  number[i] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>

  <span style=color:#75715e>/* remainder section */</span>
  } <span style=color:#66d9ef>while</span> (true);
</code></pre></div><ul>
<li>ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±</li>
<li>Overheadê°€ ë„ˆë¬´ í¬ë‹¤</li>
</ul>
</li>
</ul>
<h3 id=test-and-set-instruction-hw-solution>Test and Set Instruction (<strong>HW solution</strong>)</h3>
<ul>
<li>testset function
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>boolean <span style=color:#a6e22e>testset</span> (i) {
  <span style=color:#66d9ef>if</span> (i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
    <span style=color:#75715e>// ë“¤ì–´ê°€ì‹œì˜¤
</span><span style=color:#75715e></span>    i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
    <span style=color:#66d9ef>return</span> true;
  }
  <span style=color:#66d9ef>else</span> {
    <span style=color:#75715e>// ë“¤ì–´ê°€ì§€ ë§ˆì‹œì˜¤
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> false;
  }
}
</code></pre></div></li>
</ul>
<ul>
<li>example
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> <span style=color:#75715e>/* number of processes */</span>;
<span style=color:#66d9ef>int</span> bolt;
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>P</span>(<span style=color:#66d9ef>int</span> i) {
  <span style=color:#66d9ef>while</span> (true) {
    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!</span> testset(bolt));
    <span style=color:#75715e>/* critical section */</span>
    bolt <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#75715e>/* remainder section*/</span>
  }
}
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
  bolt <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  parbegin (P(<span style=color:#ae81ff>1</span>), P(<span style=color:#ae81ff>2</span>), ... , P(n))
}
</code></pre></div></li>
</ul>
<h3 id=semaphore-hw-solution>Semaphore (<strong>HW solution</strong>)</h3>
<ul>
<li>
<p>ê¸°ë³¸ ìš”ì†Œ</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>struct</span> semaphore {
  <span style=color:#66d9ef>int</span> count;
  queueType queue;
}

<span style=color:#66d9ef>void</span> semWait (semaphore s) {
  s.count <span style=color:#f92672>--</span>;
  <span style=color:#66d9ef>if</span> (s.count <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
    <span style=color:#75715e>// place this process in s.queue;
</span><span style=color:#75715e></span>    <span style=color:#75715e>// block this process
</span><span style=color:#75715e></span>  }
}

<span style=color:#66d9ef>void</span> semSignal (semaphore s) {
  s.count<span style=color:#f92672>++</span>;
  <span style=color:#66d9ef>if</span> (s.count <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>) {
    <span style=color:#75715e>// remove a process P from s.queue;
</span><span style=color:#75715e></span>    <span style=color:#75715e>// place process P on ready_list
</span><span style=color:#75715e></span>  }
}
</code></pre></div></li>
</ul>
<ol>
<li>basic example</li>
</ol>
<ul>
<li>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> <span style=color:#75715e>/* number of processes */</span>
semaphore s <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>P</span> (<span style=color:#66d9ef>int</span> i) {
  <span style=color:#66d9ef>while</span> (true) {
    semWait(s);
    <span style=color:#75715e>/* critical section */</span>
    semSignal(s);
    <span style=color:#75715e>/* remainder section */</span>
  }
}
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
  parbegin (P(<span style=color:#ae81ff>1</span>), P(<span style=color:#ae81ff>2</span>), ... , P(n));
}
</code></pre></div></li>
</ul>
<ol start=2>
<li>
<p>producer/consumer example</p>
<ul>
<li>producer
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>semaphore count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
semaphore empty <span style=color:#f92672>=</span> BUFFER_SIZE;
semaphore mut_ex <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>producer</span>() {
   <span style=color:#66d9ef>while</span> (true) {
       produce();
       semWait(empty);
       semWait(mut_ex);
       append(); <span style=color:#75715e>// put the produced item into buffer
</span><span style=color:#75715e></span>       semSignal(mut_ex);
       semSignal(counter);
   }
}
</code></pre></div></li>
</ul>
<ul>
<li>
<p>consumer</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>consumer</span>() {
    <span style=color:#66d9ef>while</span> (true) {
        semWait(counter)<span style=color:#f92672>:</span>
        semWait(mut_ex);
        take();
        semSignal(mut_ex);
        semSignal(empty);
        consume();
    }
}
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
   parbegin (producer1, producer2, ... , consumer);
}
</code></pre></div></li>
</ul>
</li>
<li>
<p>reader/writer example</p>
<ul>
<li>
<p>writer process</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>writer</span>() {
        <span style=color:#66d9ef>while</span>(true) {
            semWait(wsem);
            WRITEUNIT();
            semSignal(wsem);
        }
    }
</code></pre></div></li>
<li>
<p>reader process</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reader</span>() {
        <span style=color:#66d9ef>while</span> (true) {
            semWait(rsem); <span style=color:#75715e>// ë‹¤ë¥¸ reader ì ‘ê·¼ ë¶ˆê°€
</span><span style=color:#75715e></span>            readcount<span style=color:#f92672>++</span>;
            <span style=color:#66d9ef>if</span> (readcount <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) <span style=color:#75715e>// ì²«ë²ˆì§¸ ë“¤ì–´ê°€ëŠ” reader
</span><span style=color:#75715e></span>                semWait(wsem) <span style=color:#75715e>// writer ì ‘ê·¼ ë¶ˆëŠ¥
</span><span style=color:#75715e></span>            semSignal(rsem); <span style=color:#75715e>// ë‹¤ë¥¸ reader ì ‘ê·¼ ê°€ëŠ¥
</span><span style=color:#75715e></span>
            READUNIT();

            semWait(rsem); <span style=color:#75715e>// ë‹¤ë¥¸ reader ì ‘ê·¼ ë¶ˆê°€
</span><span style=color:#75715e></span>            readcount<span style=color:#f92672>--</span>;
            <span style=color:#66d9ef>if</span> (readcount <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#75715e>// ë§ˆì§€ë§‰ ë‚˜ì˜¤ëŠ” reader
</span><span style=color:#75715e></span>                semSignal(wsem); <span style=color:#75715e>// writer ì ‘ê·¼ ê°€ëŠ¥
</span><span style=color:#75715e></span>            semSignal(rsem); <span style=color:#75715e>// ë‹¤ë¥¸ reader ì ‘ê·¼ ê°€ëŠ¥
</span><span style=color:#75715e></span>        }
    }
</code></pre></div></li>
</ul>
</li>
</ol>
<ul>
<li>binary semaphore
<ul>
<li>semaphoreì˜ ê°’ì´ 0ê³¼ 1ë¡œ ì œí•œ</li>
<li>ê°’ì´ 1ë¡œ ë°”ë€Œì—ˆì„ ë•Œ,ëª¨ë“  í”„ë¡œì„¸ìŠ¤ê°€ ready stateë¡œ ë³€í™˜</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>Lock</p>
<ul>
<li>binary semaphoreë¥¼ ì´ìš©í•´ êµ¬í˜„ëœ ë™ê¸°í™” ë°©ì‹</li>
</ul>
</li>
</ul>
<h2 id=deadlock>Deadlock</h2>
<h3 id=deadlockì´ë€>Deadlockì´ë€</h3>
<ul>
<li>Starvation : ì–´ë–¤ ìì›ì„ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ì´ë¯¸ ì ìœ í•˜ê³  ìˆì–´ì„œ ì‹¤í–‰í•  ìˆ˜ ì—†ëŠ” ìƒí™©</li>
<li>Deadlock : 2ê°œ ì´ìƒì˜ processë“¤ì´ ì„œë¡œ starvationì¸ ìƒíƒœ</li>
</ul>
<h3 id=deadlockì˜-ì¡°ê±´ì„-í•˜ë‚˜ì”©-ê¹¨ë³´ì>Deadlockì˜ ì¡°ê±´ì„ í•˜ë‚˜ì”© ê¹¨ë³´ì</h3>
<ol>
<li>Mutual exclusion : OSì˜ í•„ìˆ˜ ê¸°ëŠ¥</li>
<li>Hold and wait : ì‹œì‘ë¶€í„° ëª¨ë“  ìì›ì„ ë°›ë„ë¡ êµ¬í˜„ -> ë¹„íš¨ìœ¨ì </li>
<li>No Preemption : ìì›ì„ ì„œë¡œ ëºì–´ê° -> ë¹„íš¨ìœ¨ì </li>
<li>Circular Wait : ìì›ì„ ë¨¼ì € ë°›ì•„ì•¼ í•˜ëŠ” ê²½ìš° ì¡´ì¬</li>
</ol>
<h3 id=í•´ê²°ë°©ë²•>í•´ê²°ë°©ë²•</h3>
<ul>
<li>ìµœì„ ì˜ ë°©ë²• : deadlockì´ ë°œìƒí–ˆì„ ë•Œ, í•œ ê°œì”© ì£½ì—¬ë³´ê¸°</li>
</ul>
<h2 id=file-management>File Management</h2>
<h3 id=fcb>FCB</h3>
<ul>
<li>File Control block, ë³´ì¡°ê¸°ì–µì¥ì¹˜ì— ì €ì¥</li>
<li>êµ¬ì„±
<blockquote>
<p>file name, file size, uid, gid, file operation, creation time, last modified, last access time, address of file data&mldr;</p>
</blockquote>
</li>
</ul>
<h3 id=device-file>Device file</h3>
<ul>
<li>ë¸”ë¡í˜• íŒŒì¼ (ë‹¨ìœ„ : 4096byte)</li>
<li>file size ëŒ€ì‹  major number, minor number ì¡´ì¬</li>
<li>Device I/Oê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ Device Fileê³¼ I/O í•˜ë“¯ì´ ì‘ë™</li>
</ul>
</article>
<div id=meta class=mt-24>
<div>
<div class="flex justify-between w-full whitespace-nowrap hover-bold">
<a class="previous mr-5 overflow-hidden overflow-ellipsis" href=/til/school/datastructure/>
ìë£Œêµ¬ì¡°</a>
<a class="next ml-5 overflow-hidden overflow-ellipsis" href=/til/school/basicprojectlab_design_thinking/> 230315 ê¸°í”„ë© Design Thinking ë°©ë²•ë¡  - ê¹€ì¬ì • êµìˆ˜ë‹˜</a>
</div>
</div>
</div>
</section>
</main>
</body>
</html>