<!doctype html><html>
<head>
<title>[ëª¨ê°ì½”24í•˜ê³„] 02 : ê²°ê³¼</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="RAG (Retrieval-Augmented Generation) ì´ë¡  ì •ë¦¬  RAGëŠ” ê²€ìƒ‰ê³¼ ìƒì„±ì„ ê²°í•©í•œ ëª¨ë¸ë¡œ, â€¦">
<meta property="og:site_name" content="bong-u/til">
<meta property="og:title" content="[ëª¨ê°ì½”24í•˜ê³„] 02 : ê²°ê³¼">
<meta property="og:description" content="RAG (Retrieval-Augmented Generation) ì´ë¡  ì •ë¦¬  RAGëŠ” ê²€ìƒ‰ê³¼ ìƒì„±ì„ ê²°í•©í•œ ëª¨ë¸ë¡œ, â€¦">
<meta property="og:type" content="blog">
<meta property="og:url" content="https://github.com/bong-u/til-hugo">
<meta property="og:image" content="https://bong-u.github.io/til/asset/thumbnail.jpg">
<script type=text/javascript src=https://bong-u.github.io/til/script/base.js></script>
<link rel=icon href=https://bong-u.github.io/til/favicon16.png sizes=16x16>
<link rel=icon href=https://bong-u.github.io/til/favicon32.png sizes=32x32>
<link rel=icon href=https://bong-u.github.io/til/favicon48.png sizes=48x48>
<link rel=icon href=https://bong-u.github.io/til/favicon64.png sizes=64x64>
<link id=twCSS rel=stylesheet href=https://bong-u.github.io/til/css/style.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HE9FQR1ML7"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-HE9FQR1ML7')</script>
</head>
<body class=custom-scroll>
<div class="flex w-full flex-col items-center">
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script>
<script>MathJax={tex:{inlineMath:[['$','$']]}}</script>
<script type=text/javascript src=https://bong-u.github.io/til/script/single.js></script>
<script type=text/javascript src=https://bong-u.github.io/til/script/toc.js></script>
<header class="flex justify-center p-3 w-full text-lg border-b border-line">
<div class="w-full flex justify-between lg-5/6">
<h3>
<a href=https://bong-u.github.io/til/ class=hover-black>
bong-u/til
</a>
</h3>
<div class="flex gap-5">
<a class=hover-black href=https://bong-u.github.io/til/>
ğŸ  home
</a>
<a class=hover-black href=https://github.com/bong-u/til>
ğŸˆ repository
</a>
</div>
</div>
</header>
<input type=checkbox id=toggleDarkMode onchange=toggleDarkModeHandler() hidden>
<main class="w-full lg:w-5/6 px-3 sm:px-12">
<aside class="fixed top-0 right-0 my-24 w-1/6 gap-3 px-9 hidden xl:flex text-sm overflow-hidden">
<nav id=TableOfContents>
<ul>
<li><a href=#rag-retrieval-augmented-generation-ì´ë¡ -ì •ë¦¬>RAG (Retrieval-Augmented Generation) ì´ë¡  ì •ë¦¬</a></li>
<li><a href=#opensearch>OpenSearch</a>
<ul>
<li><a href=#ë¶„ì„>ë¶„ì„</a></li>
<li><a href=#opensearchì—ì„œ-ì§€ì›í•˜ëŠ”-ìš”ì†Œ>OpenSearchì—ì„œ ì§€ì›í•˜ëŠ” ìš”ì†Œ</a></li>
<li><a href=#opensearch-ì ‘ê·¼ì„-ìœ„í•œ-curl-ëª…ë ¹ì–´>OpenSearch ì ‘ê·¼ì„ ìœ„í•œ cURL ëª…ë ¹ì–´</a></li>
</ul>
</li>
<li><a href=#opensearchë¥¼-í™œìš©í•œ-rag-ì‹¤ìŠµ>OpenSearchë¥¼ í™œìš©í•œ Rag ì‹¤ìŠµ</a>
<ul>
<li><a href=#ë°°ê²½>ë°°ê²½</a></li>
<li><a href=#ìˆœì„œ>ìˆœì„œ</a></li>
<li><a href=#1-ì¼ë¡ -ë¨¸ìŠ¤í¬-ì¸í„°ë·°-í…ìŠ¤íŠ¸-ê°€ì ¸ì˜¤ê¸°>1. ì¼ë¡  ë¨¸ìŠ¤í¬ ì¸í„°ë·° í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°</a></li>
<li><a href=#2-opensearch-ë„ì»¤-ì»¨í…Œì´ë„ˆ-ì‹¤í–‰>2. OpenSearch ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰</a></li>
<li><a href=#3-í…ìŠ¤íŠ¸-ë°ì´í„°-ì„ë² ë”©-ë°-opensearchì—-ì €ì¥>3. í…ìŠ¤íŠ¸ ë°ì´í„° ì„ë² ë”© ë° OpenSearchì— ì €ì¥</a></li>
<li><a href=#4-rag-ëª¨ë¸ì´-opensearchë¥¼-ì¿¼ë¦¬í•˜ì—¬-ëŒ€ë‹µ-ìƒì„±>4. RAG ëª¨ë¸ì´ OpenSearchë¥¼ ì¿¼ë¦¬í•˜ì—¬ ëŒ€ë‹µ ìƒì„±</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
<section class="my-16 xl:w-5/6">
<div class="mb-8 whitespace-nowrap">
<div class="flex justify-between items-baseline my-4 gap-8">
<h1 id=title class="overflow-ellipsis-bundle text-3xl font-bold p-1">
[ëª¨ê°ì½”24í•˜ê³„] 02 : ê²°ê³¼
</h1>
</div>
</div>
<div class="text-sm flex mb-8 justify-between text-textgray">
<div>
<span class="text-md mr-1">ğŸ·ï¸ rag</span>
</div>
<h4 id=date>ìˆ˜ì •ì¼ : 2024-11-15</h4>
</div>
<hr class=opacity-30>
<article data-pagefind-body id=content class="bg-inherit markdown-body flex flex-col">
<h2 id=rag-retrieval-augmented-generation-ì´ë¡ -ì •ë¦¬>RAG (Retrieval-Augmented Generation) ì´ë¡  ì •ë¦¬</h2>
<blockquote>
<p>RAGëŠ” ê²€ìƒ‰ê³¼ ìƒì„±ì„ ê²°í•©í•œ ëª¨ë¸ë¡œ, ê²€ìƒ‰ì„ í†µí•´ ì–»ì€ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒì„±ì„ ìˆ˜í–‰í•˜ëŠ” ëª¨ë¸</p>
</blockquote>
<ul>
<li>
<p>LLMì˜ ë¬¸ì œì </p>
<ul>
<li>í• ë£¨ì‹œë„¤ì´ì…˜: ìƒì„± ëª¨ë¸ì´ í›ˆë ¨ ë°ì´í„°ì— ì—†ëŠ” ë‚´ìš©ì„ ìƒì„±í•˜ëŠ” í˜„ìƒ</li>
<li>ìµœì‹ ì˜ ì‘ë‹µì„ ê¸°ëŒ€í•˜ëŠ” ìƒí™©ì—ì„œ ì˜¤ë˜ë˜ì—ˆê±°ë‚˜ ì¼ë°˜ì ì¸ ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ë¬¸ì œ</li>
<li>ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì¶œì²˜ë¡œë¶€í„° ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ë¬¸ì œ</li>
</ul>
</li>
<li>
<p>RAGëŠ” ìœ„ì—ì„œ ì„œìˆ í•œ LLM ë¬¸ì œì˜ ì¼ë¶€ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìˆ˜ë‹¨ì´ë‹¤.</p>
</li>
</ul>
<h2 id=opensearch>OpenSearch</h2>
<blockquote>
<p>OpenSearchëŠ” ì˜¤í”ˆì†ŒìŠ¤ ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ìœ¼ë¡œ, ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì˜ í¬í¬ ë²„ì „</p>
</blockquote>
<ul>
<li>
<p>ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ : ë²¡í„° ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¿¼ë¦¬í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤</p>
</li>
<li>
<p>ì£¼ìš” ê¸°ëŠ¥</p>
<ul>
<li>ë¶„ì‚° ê²€ìƒ‰ ë° ë¶„ì„</li>
<li>ë³´ì•ˆ</li>
<li>ì‹œê°í™”ì™€ ëŒ€ì‹œë³´ë“œ ì§€ì›</li>
</ul>
</li>
<li>
<p>indexì™€ document</p>
<ul>
<li>index : ë°ì´í„°ë² ì´ìŠ¤</li>
<li>document : ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ëŠ” ë°ì´í„°</li>
</ul>
</li>
</ul>
<h3 id=ë¶„ì„>ë¶„ì„</h3>
<ul>
<li>ë¶„ì„ê¸° Analyzer (Character Filter + Tokenizer + Token Filter)
<blockquote>
<p>í…ìŠ¤íŠ¸ë¥¼ í† í°í™”í•˜ê³  í•„í„°ë§í•˜ëŠ” ê³¼ì •ì„ ìˆ˜í–‰</p>
</blockquote>
</li>
<li>ë¶„ì„ ê³¼ì •
<ol>
<li>Character Filter
<blockquote>
<p>íŠ¹ì • ë¬¸ìë¥¼ ì œê±°í•˜ê±°ë‚˜ ë³€ê²½í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰</p>
</blockquote>
</li>
<li>Tokenizer
<blockquote>
<p>ê¸°ë³¸ì ìœ¼ë¡œ ê³µë°±ì„ ê¸°ì¤€ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬</p>
</blockquote>
</li>
<li>Token Filter
<blockquote>
<p>í† í°ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h3 id=opensearchì—ì„œ-ì§€ì›í•˜ëŠ”-ìš”ì†Œ>OpenSearchì—ì„œ ì§€ì›í•˜ëŠ” ìš”ì†Œ</h3>
<ol>
<li>Tokenizer
<ul>
<li>Standard Tokenizer : ê³µë°±ì„ ê¸°ì¤€ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬, ë¬¸ì¥ ë¶€í˜¸ ì‚­ì œ</li>
<li>Letter Tokenizer : ë¬¸ìë¥¼ ê¸°ì¤€ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬</li>
<li>Whitespace Tokenizer : ê³µë°±ì„ ê¸°ì¤€ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬</li>
<li>Ngram Tokenizer : ë¶€ë¶„ ë¬¸ìì—´ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬</li>
</ul>
</li>
<li>Token Filter
<ul>
<li>Standard Token Filter : ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ</li>
<li>Lowercase Token Filter : í…ìŠ¤íŠ¸ë¥¼ ì†Œë¬¸ìë¡œ ë³€í™˜</li>
<li>Synonym Token Filter : ë™ì˜ì–´ ì²˜ë¦¬</li>
</ul>
</li>
<li>Analyzer
<ul>
<li>Standard Analyzer : Standard Tokenizer + Standard Token Filter</li>
<li>Simple Analyzer : Letter Tokenizer + Lowercase Token Filter</li>
<li>Whitespace Analyzer : Whitespace Tokenizer + Lowercase Token Filter</li>
</ul>
</li>
</ol>
<h3 id=opensearch-ì ‘ê·¼ì„-ìœ„í•œ-curl-ëª…ë ¹ì–´>OpenSearch ì ‘ê·¼ì„ ìœ„í•œ cURL ëª…ë ¹ì–´</h3>
<ul>
<li>ì¸ë±ìŠ¤ ì¡°íšŒ
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>curl -X GET -u <span style=color:#f92672>{</span>username<span style=color:#f92672>}</span>:<span style=color:#f92672>{</span>password<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#ae81ff></span><span style=color:#e6db74>&#34;http://localhost:9200/_cat/indices&#34;</span>
</code></pre></div></li>
<li>íŠ¹ì • ì¸ë±ìŠ¤ ì¡°íšŒ
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>curl -X GET -u <span style=color:#f92672>{</span>username<span style=color:#f92672>}</span>:<span style=color:#f92672>{</span>password<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#ae81ff></span><span style=color:#e6db74>&#34;http://localhost:9200/{index_name}&#34;</span>
</code></pre></div></li>
<li>ì „ì²´ ê²€ìƒ‰ ê²°ê³¼ ì¡°íšŒ
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>curl -X GET -u <span style=color:#f92672>{</span>username<span style=color:#f92672>}</span>:<span style=color:#f92672>{</span>password<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#ae81ff></span><span style=color:#e6db74>&#34;http://localhost:9200/{index_name}/_search&#34;</span>
</code></pre></div></li>
<li>íŠ¹ì • ê²€ìƒ‰ì–´ë¡œ ê²€ìƒ‰í•œ ê²°ê³¼ ì¡°íšŒ
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>curl -X GET -u <span style=color:#f92672>{</span>username<span style=color:#f92672>}</span>:<span style=color:#f92672>{</span>password<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#ae81ff></span><span style=color:#e6db74>&#34;http://localhost:9200/{index_name}/_search&#34;</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#ae81ff></span>-H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#ae81ff></span>-d <span style=color:#e6db74>&#39;{&#34;query&#34;: {&#34;match&#34;: {&#34;field&#34;: &#34;value&#34;}}}&#39;</span>
</code></pre></div></li>
<li>ì¸ë±ìŠ¤ ì‚­ì œ
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>curl -X DELETE -u <span style=color:#f92672>{</span>username<span style=color:#f92672>}</span>:<span style=color:#f92672>{</span>password<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#ae81ff></span><span style=color:#e6db74>&#34;http://localhost:9200/{index_name}&#34;</span>
</code></pre></div></li>
</ul>
<h2 id=opensearchë¥¼-í™œìš©í•œ-rag-ì‹¤ìŠµ>OpenSearchë¥¼ í™œìš©í•œ Rag ì‹¤ìŠµ</h2>
<h3 id=ë°°ê²½>ë°°ê²½</h3>
<ul>
<li>í…Œì»¤ ë¶€íŠ¸ìº í”„ì—ì„œ íŒ€í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰ ì¤‘ì´ë‹¤.</li>
<li>ìš°ë¦¬ íŒ€ì˜ ì£¼ì œëŠ” íŠ¹ì • ì¸ë¬¼ì—ê²Œ ìƒë‹´ì„ ë°›ëŠ” ê²ƒ ê°™ì€ ëŒ€í™”ë¥¼ í•  ìˆ˜ ìˆëŠ” ì±—ë´‡ì„ ë§Œë“œëŠ” ê²ƒì´ë‹¤.</li>
<li>ì´ë¥¼ ìœ„í•´ íŠ¹ì • ì¸ë¬¼ì´ í–ˆë˜ ë§ì„ ëª¨ì•„ ë°ì´í„°ì…‹ìœ¼ë¡œ ë§Œë“¤ê³  ì´ë¥¼ RAG ëª¨ë¸ì— ì ìš©ì‹œí‚¤ë ¤ê³  í•œë‹¤.</li>
</ul>
<h3 id=ìˆœì„œ>ìˆœì„œ</h3>
<ol>
<li>ì¼ë¡  ë¨¸ìŠ¤í¬ê°€ TEDì—ì„œ í•œ ì¸í„°ë·°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ê°€ì ¸ì˜¨ë‹¤.</li>
<li>OpenSearch ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œë‹¤.</li>
<li>í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì„ë² ë”©í•´ì„œ OpenSearchì— ì €ì¥í•œë‹¤.</li>
<li>RAG ëª¨ë¸ì´ OpenSearchë¥¼ ì¿¼ë¦¬í•˜ì—¬ ëŒ€ë‹µì„ ìƒì„±í•œë‹¤.</li>
</ol>
<h3 id=1-ì¼ë¡ -ë¨¸ìŠ¤í¬-ì¸í„°ë·°-í…ìŠ¤íŠ¸-ê°€ì ¸ì˜¤ê¸°>1. ì¼ë¡  ë¨¸ìŠ¤í¬ ì¸í„°ë·° í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°</h3>
<ul>
<li>
<p>ìœ íŠœë¸Œì—ì„œ &ldquo;ìŠ¤í¬ë¦½íŠ¸ ë³´ê¸°"ë¥¼ í†µí•´ ì¸í„°ë·° ìë§‰ì„ ê°€ì ¸ì˜¨ë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>22:03
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>EM: ì´ í° íŠ¸ëŸ­ì„ ëª°ë©´ì„œ ë§ë„ ì•ˆë˜ëŠ” ì›€ì§ì„ì„ ë³´ì˜€ì£ .
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>CA: ì•„ì£¼ ë©‹ì§€ë„¤ìš”. ì, ê·¸ëŸ¼ ì •ë§ êµ‰ì¥í•œ ì‚¬ì§„ì—ì„œ
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>22:09
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>ì¡°ê¸ˆì€ ëœ êµ‰ì¥í•œ ì‚¬ì§„ì„ ë³´ì£ . &#34;ìœ„ê¸°ì˜ ì£¼ë¶€ë“¤&#34;ì¸ê°€ì—ì„œ ë‚˜ì˜¤ëŠ” ê·€ì—¬ìš´ ì§‘ ì‚¬ì§„ì¸ë°ìš”.
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>22:15
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>ì´ê²Œ ê°‘ìê¸° ì™œ ë‚˜ì˜¨ê±°ì£ ?
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>...
</code></pre></div></li>
<li>
<p>ì¼ë¡  ë¨¸ìŠ¤í¬ê°€ í•œ ë§ë§Œ ì†ìˆ˜ ì •ë¦¬í•œë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>ë„¤. ì œ ìŠ¤ìŠ¤ë¡œë„ ê·¸ ì§ˆë¬¸ì„ ìì£¼ í•˜ëŠ” í¸ì…ë‹ˆë‹¤.
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>ì €í¬ëŠ” LAì˜ ì§€í•˜ì— êµ¬ë©ì„ ë‚´ë ¤ê³  í•˜ëŠ”ë°ìš”. ì´ëŠ” êµí†µ ì²´ì¦ì„ ì™„í™”ì‹œí‚¤ê¸° ìœ„í•œ
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>3ì°¨ì› ë„¤íŠ¸ì›Œí¬ì˜ í„°ë„ì´ ë  ìˆ˜ë„ ìˆëŠ” ì‹œë°œì ì„ ë§Œë“¤ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>êµí†µ ì²´ì¦ì€ ì˜¤ëŠ˜ë‚  ìš°ë¦¬ì˜ ì˜í˜¼ì„ íƒˆíƒˆ í„°ëŠ” ë¬¸ì œ ì¤‘ì˜ í•˜ë‚˜ì…ë‹ˆë‹¤.
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>ì„¸ê³„ ëª¨ë“  ì‚¬ëŒë“¤ì—ê²Œ ì˜í–¥ì„ ë¼ì¹˜ê³  ìˆì£ . ì¸ìƒì—ì„œ ë„ˆë¬´ë„ ë§ì€ ë¶€ë¶„ì„ ê°€ì ¸ê°‘ë‹ˆë‹¤.
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>...
</code></pre></div></li>
</ul>
<h3 id=2-opensearch-ë„ì»¤-ì»¨í…Œì´ë„ˆ-ì‹¤í–‰>2. OpenSearch ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>docker create -it -p 9200:9200 -p 9600:9600 -e OPENSEARCH_INITIAL_ADMIN_PASSWORD<span style=color:#f92672>={</span>password<span style=color:#f92672>}</span> -e <span style=color:#e6db74>&#34;discovery.type=single-node&#34;</span> -v opensearch_vol:/usr/share/opensearch/data --name opensearch opensearchproject/opensearch
</code></pre></div><ul>
<li>ì„¤ëª…
<ul>
<li>-p 9200:9200 : OpenSearch HTTP í¬íŠ¸</li>
<li>-p 9600:9600 : OpenSearch ëª¨ë‹ˆí„°ë§ í¬íŠ¸</li>
<li>-e OPENSEARCH_INITIAL_ADMIN_PASSWORD={password} : ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</li>
<li>-e &ldquo;discovery.type=single-node&rdquo; : ë‹¨ì¼ ë…¸ë“œë¡œ ì‹¤í–‰</li>
<li>-v opensearch_vol:/usr/share/opensearch/data : ë°ì´í„° ë³¼ë¥¨ ë§ˆìš´íŠ¸</li>
</ul>
</li>
</ul>
<h4 id=ssl-ì˜¤ë¥˜-ë°œìƒê³¼-í•´ê²°>SSL ì˜¤ë¥˜ ë°œìƒê³¼ í•´ê²°</h4>
<ul>
<li>
<p>í•˜ì§€ë§Œ ìœ„ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•˜ë©´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>2024-07-05 22:15:12 Caused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: ...
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>2024-07-05 22:15:12     at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1314) ~[netty-handler-4.1.110.Final.jar:4.1.110.Final]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>2024-07-05 22:15:12     at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1387) ~[netty-handler-4.1.110.Final.jar:4.1.110.Final]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>2024-07-05 22:15:12     at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530) ~[netty-codec-4.1.110.Final.jar:4.1.110.Final]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>2024-07-05 22:15:12     at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469) ~[netty-codec-4.1.110.Final.jar:4.1.110.Final]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>2024-07-05 22:15:12     ... 16 more
</code></pre></div></li>
<li>
<p>í”„ë¡œì íŠ¸ ê¸°ê°„ì´ ê¸¸ì§€ ì•Šê³ , í•´ë‹¹ í¬íŠ¸ëŠ” ì™¸ë¶€ì— ë…¸ì¶œí•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ SSLì„ ë„ê³  ì‹¤í–‰í•˜ëŠ” ê²ƒìœ¼ë¡œ í•´ê²°í•˜ì˜€ë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#ae81ff>/usr/share/opensearch/config/opensearch.yml</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#75715e># ë³€ê²½ ì „</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#f92672>plugins.security.ssl.http.enabled</span>: <span style=color:#66d9ef>true</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#75715e># ë³€ê²½ í›„</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span style=color:#f92672>plugins.security.ssl.http.enabled</span>: <span style=color:#66d9ef>false</span>
</code></pre></div></li>
</ul>
<h3 id=3-í…ìŠ¤íŠ¸-ë°ì´í„°-ì„ë² ë”©-ë°-opensearchì—-ì €ì¥>3. í…ìŠ¤íŠ¸ ë°ì´í„° ì„ë² ë”© ë° OpenSearchì— ì €ì¥</h3>
<blockquote>
<p>RAG ì„¸ì…˜ì„ í•´ì£¼ì‹  ë©˜í† ë‹˜ì´ ì§œì¤€ ì½”ë“œë¥¼ ì ê·¹! ì°¸ê³ í•˜ì—¬ ì‘ì„±í•˜ì˜€ë‹¤.</p>
</blockquote>
<h4 id=opensearch-ì¸ë±ìŠ¤-ìƒì„±>OpenSearch ì¸ë±ìŠ¤ ìƒì„±</h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span style=color:#f92672>from</span> opensearchpy <span style=color:#f92672>import</span> OpenSearch
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span style=color:#f92672>import</span> torch
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span style=color:#f92672>from</span> transformers <span style=color:#f92672>import</span> AutoTokenizer, AutoModel
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span style=color:#f92672>from</span> langchain.text_splitter <span style=color:#f92672>import</span> RecursiveCharacterTextSplitter
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span style=color:#f92672>from</span> langchain_community.document_loaders <span style=color:#f92672>import</span> TextLoader
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span style=color:#f92672>from</span> langchain_community.vectorstores <span style=color:#f92672>import</span> OpenSearchVectorSearch
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span>INDEX_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;elon_musk&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span>FILE_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ted_elon_musk_script.txt&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span style=color:#75715e>## OpenSearch ì—°ê²° ì„¤ì •</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span>client <span style=color:#f92672>=</span> OpenSearch(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span>    hosts<span style=color:#f92672>=</span>[{<span style=color:#e6db74>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;localhost&#34;</span>, <span style=color:#e6db74>&#34;port&#34;</span>: <span style=color:#ae81ff>9200</span>}], http_auth<span style=color:#f92672>=</span>(<span style=color:#e6db74>&#34;admin&#34;</span>, {password})
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span style=color:#75715e>## í…ìŠ¤íŠ¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span>loader <span style=color:#f92672>=</span> TextLoader(file_path<span style=color:#f92672>=</span>FILE_NAME, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span>docs <span style=color:#f92672>=</span> loader<span style=color:#f92672>.</span>load()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span>text_splitter <span style=color:#f92672>=</span> RecursiveCharacterTextSplitter(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span>    chunk_size<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span>    chunk_overlap<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span>    separators<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>],
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span>    length_function<span style=color:#f92672>=</span>len,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span>documents <span style=color:#f92672>=</span> text_splitter<span style=color:#f92672>.</span>split_documents(docs)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span style=color:#75715e># print(documents)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span style=color:#75715e>## Embedding ëª¨ë¸ ì •ì˜</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyEmbeddingModel</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span>    <span style=color:#66d9ef>def</span> __init__(self, model_name):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span>        self<span style=color:#f92672>.</span>tokenizer <span style=color:#f92672>=</span> AutoTokenizer<span style=color:#f92672>.</span>from_pretrained(model_name)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span>        self<span style=color:#f92672>.</span>model <span style=color:#f92672>=</span> AutoModel<span style=color:#f92672>.</span>from_pretrained(model_name)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>embed_documents</span>(self, doc):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span>        inputs <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>tokenizer(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span>            doc, return_tensors<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pt&#34;</span>, padding<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, truncation<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, max_length<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span>        )
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span>        <span style=color:#66d9ef>with</span> torch<span style=color:#f92672>.</span>no_grad():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span>            outputs <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>model(<span style=color:#f92672>**</span>inputs)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span>            embeddings <span style=color:#f92672>=</span> outputs<span style=color:#f92672>.</span>last_hidden_state<span style=color:#f92672>.</span>mean(dim<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>tolist()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span>        <span style=color:#66d9ef>return</span> embeddings
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>embed_query</span>(self, text):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span>        inputs <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>tokenizer(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span>            [text], padding<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, truncation<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, return_tensors<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pt&#34;</span>, max_length<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span>        )
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span>        <span style=color:#66d9ef>with</span> torch<span style=color:#f92672>.</span>no_grad():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span>            outputs <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>model(<span style=color:#f92672>**</span>inputs)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span>            embeddings <span style=color:#f92672>=</span> outputs<span style=color:#f92672>.</span>last_hidden_state<span style=color:#f92672>.</span>mean(dim<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>tolist()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span>        <span style=color:#66d9ef>return</span> embeddings
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span style=color:#75715e>## index êµ¬ì¡° ì •ì˜</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span>index_body <span style=color:#f92672>=</span> {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span>    <span style=color:#e6db74>&#34;settings&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span>        <span style=color:#e6db74>&#34;analysis&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span>            <span style=color:#e6db74>&#34;tokenizer&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span>                <span style=color:#e6db74>&#34;nori_user_dict&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span>                    <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;nori_tokenizer&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span>                    <span style=color:#e6db74>&#34;decompound_mode&#34;</span>: <span style=color:#e6db74>&#34;mixed&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span>                    <span style=color:#e6db74>&#34;user_dictionary&#34;</span>: <span style=color:#e6db74>&#34;user_dic.txt&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span>                }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span>            },
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span>            <span style=color:#e6db74>&#34;analyzer&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span>                <span style=color:#e6db74>&#34;korean_anlyzer&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span>                    <span style=color:#e6db74>&#34;filter&#34;</span>: [
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span>                        <span style=color:#e6db74>&#34;synonym&#34;</span>, <span style=color:#e6db74>&#34;lowercase&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span>                    ],
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span>                    <span style=color:#e6db74>&#34;tokenizer&#34;</span>: <span style=color:#e6db74>&#34;nori_user_dict&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span>                }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span>            },
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span>            <span style=color:#e6db74>&#34;filter&#34;</span>: {
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span>                <span style=color:#e6db74>&#34;synonym&#34;</span> :{
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span>                    <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;synonym_graph&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span>                    <span style=color:#e6db74>&#34;synonyms_path&#34;</span> : <span style=color:#e6db74>&#34;synonyms.txt&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span>                }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span>            }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span>        }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span style=color:#75715e>## Embedding ëª¨ë¸ ìƒì„±</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span>my_embedding <span style=color:#f92672>=</span> MyEmbeddingModel(<span style=color:#e6db74>&#34;monologg/kobert&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span style=color:#75715e>## OpenSearchì— ë°ì´í„° ì‚½ì…</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span>vector_db <span style=color:#f92672>=</span> OpenSearchVectorSearch<span style=color:#f92672>.</span>from_documents(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span>    index_name<span style=color:#f92672>=</span>INDEX_NAME,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span>    body<span style=color:#f92672>=</span>index_body,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span>    documents<span style=color:#f92672>=</span>documents,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span>    embedding<span style=color:#f92672>=</span>my_embedding,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span>    op_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;create&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span>    opensearch_url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:9200&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span>    http_auth<span style=color:#f92672>=</span>(<span style=color:#e6db74>&#34;admin&#34;</span>, {password}),
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span>    use_ssl<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span>    verify_certs<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span>    ssl_assert_hostname<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span>    ssl_show_warn<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span>    bulk_size<span style=color:#f92672>=</span><span style=color:#ae81ff>1000000</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span>    timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>360000</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span>result <span style=color:#f92672>=</span> vector_db<span style=color:#f92672>.</span>add_documents(documents, bulk_size<span style=color:#f92672>=</span><span style=color:#ae81ff>1000000</span>)
</code></pre></div><ul>
<li>tokenizerëŠ” í•œêµ­ì–´ë¥¼ ì§€ì›í•˜ëŠ” &ldquo;nori_tokenizer"ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.</li>
<li>embedding ëª¨ë¸ì€ ì €ê±° ë§ê³ ë„ ì—¬ëŸ¬ê°€ì§€ê°€ ì¡´ì¬í•˜ëŠ”ë°, ì–´ë–¤ ëª¨ë¸ì´ í”„ë¡œì íŠ¸ì— ê°€ì¥ ë¶€í•©í•˜ëŠ” ëª¨ë¸ì¸ì§€ëŠ” ì‹¤í—˜ì„ í•´ë³¼ ê²ƒì´ë‹¤.</li>
<li>curlì„ í†µí•´ localhost:9200/elon_musk/_searchë¡œ ìš”ì²­ì„ ë³´ë‚´ ì„ë² ë”©í•œ ë°ì´í„°ê°€ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li>
</ul>
<h3 id=4-rag-ëª¨ë¸ì´-opensearchë¥¼-ì¿¼ë¦¬í•˜ì—¬-ëŒ€ë‹µ-ìƒì„±>4. RAG ëª¨ë¸ì´ OpenSearchë¥¼ ì¿¼ë¦¬í•˜ì—¬ ëŒ€ë‹µ ìƒì„±</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#f92672>from</span> langchain.prompts <span style=color:#f92672>import</span> PromptTemplate
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#f92672>from</span> langchain.chains <span style=color:#f92672>import</span> LLMChain
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#f92672>from</span> langchain_openai <span style=color:#f92672>import</span> ChatOpenAI
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#f92672>from</span> opensearchpy <span style=color:#f92672>import</span> OpenSearch
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#f92672>import</span> os
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>INDEX_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;elon_musk&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span style=color:#75715e># í™˜ê²½ë³€ìˆ˜ ì„¤ì •</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#34;OPENAI_API_KEY&#34;</span>] <span style=color:#f92672>=</span> {api_key}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>llm <span style=color:#f92672>=</span> ChatOpenAI(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    model_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gpt-3.5-turbo&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>prompt_template <span style=color:#f92672>=</span> PromptTemplate(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>    input_variables<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;context&#34;</span>, <span style=color:#e6db74>&#34;question&#34;</span>],
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>    template<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;&#34;
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span style=color:#e6db74>Imagine you are </span><span style=color:#e6db74>{character_name}</span><span style=color:#e6db74>,
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span style=color:#e6db74>a wise and experienced advisor. Given the context: &#34;</span><span style=color:#e6db74>{context}</span><span style=color:#e6db74>&#34;,
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span style=color:#e6db74>how would you respond to this inquiry: &#34;</span><span style=color:#e6db74>{question}</span><span style=color:#e6db74>&#34;?&#39;,
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span style=color:#e6db74>(in korean)
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span style=color:#e6db74>&#34;&#34;&#34;</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>llm_chain <span style=color:#f92672>=</span> LLMChain(llm<span style=color:#f92672>=</span>llm, prompt<span style=color:#f92672>=</span>prompt_template)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>client <span style=color:#f92672>=</span> OpenSearch(
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>    hosts<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;http://localhost:9200&#34;</span>],
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>    http_auth<span style=color:#f92672>=</span>(<span style=color:#e6db74>&#34;admin&#34;</span>, {password}),
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span>    use_ssl<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span>    verify_certs<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>    ssl_assert_hostname<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>    ssl_show_warn<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>search_documents</span>(query):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span>    search_body <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;query&#34;</span>: {<span style=color:#e6db74>&#34;match&#34;</span>: {<span style=color:#e6db74>&#34;text&#34;</span>: query}}}
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span>    response <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>search(index<span style=color:#f92672>=</span>INDEX_NAME, body<span style=color:#f92672>=</span>search_body)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span>    hits <span style=color:#f92672>=</span> response[<span style=color:#e6db74>&#34;`its&#34;</span>][<span style=color:#e6db74>&#34;hits&#34;</span>]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span>    <span style=color:#66d9ef>return</span> [hit[<span style=color:#e6db74>&#34;_source&#34;</span>][<span style=color:#e6db74>&#34;text&#34;</span>] <span style=color:#66d9ef>for</span> hit <span style=color:#f92672>in</span> hits]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span>    question <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Enter your question</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span>    search_results <span style=color:#f92672>=</span> search_documents(question)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span>    print(search_results)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span>    <span style=color:#75715e># context = &#34; &#34;.join(search_results)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span>    context <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span>    response <span style=color:#f92672>=</span> llm_chain<span style=color:#f92672>.</span>invoke({<span style=color:#e6db74>&#34;character_name&#34;</span>: INDEX_NAME, <span style=color:#e6db74>&#34;context&#34;</span>: context, <span style=color:#e6db74>&#34;question&#34;</span>: question})
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span>    print (response[<span style=color:#e6db74>&#34;text&#34;</span>])
</code></pre></div><ul>
<li>OpenSearchì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¿¼ë¦¬í•˜ì—¬ RAG ëª¨ë¸ì— ë„£ì–´ ëŒ€ë‹µì„ ìƒì„±í•œë‹¤.</li>
<li>search_documents í•¨ìˆ˜ë¥¼ í†µí•´ OpenSearchì— ì¿¼ë¦¬ë¥¼ ë³´ë‚´ê³ , ê·¸ ê²°ê³¼ë¥¼ contextë¡œ ì‚¬ìš©í•œë‹¤.</li>
</ul>
<h4 id=ê²°ê³¼>ê²°ê³¼</h4>
<ul>
<li>ì§ˆë¬¸
<blockquote>
<p>í…ŒìŠ¬ë¼ì— ëŒ€í•´ì„œ ì–´ë–»ê²Œ ìƒê°í•´?</p>
</blockquote>
</li>
<li>RAGë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œì˜ ëŒ€ë‹µ
<blockquote>
<p>í…ŒìŠ¬ë¼ëŠ” í˜ì‹ ì ì¸ ê¸°ì—…ìœ¼ë¡œì„œ ë¯¸ë˜ë¥¼ í–¥í•œ ë¹„ì „ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë“¤ì˜ ì „ê¸° ìë™ì°¨ ê¸°ìˆ ê³¼ ì—ë„ˆì§€ ì†”ë£¨ì…˜ì€ ì „ ì„¸ê³„ì ìœ¼ë¡œ ì£¼ëª©ë°›ê³  ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¬ë¼ì˜ í˜ì‹ ì ì¸ ì ‘ê·¼ ë°©ì‹ê³¼ ì§€ì† ê°€ëŠ¥í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ì— ëŒ€í•´ ë§¤ìš° ê¸ì •ì ìœ¼ë¡œ ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>
</li>
<li>RAGë¥¼ ì‚¬ìš©í• ë•Œ ì ìš©ëœ context
<blockquote>
<p>[&lsquo;ê¸¸ê²Œ ê°ˆ ê²ƒ ê°™ì§€ëŠ” ì•Šì•„ìš”.\nê·¸ëŸ¬ë„¤ìš”. ì €ëŠ” ìµœëŒ€í•œ ì˜¤ë«ë™ì•ˆ í…ŒìŠ¬ë¼ì— ë¨¸ë¬¼ ìƒê°ì´ì—ìš”.\nê·¸ë¦¬ê³  ì¤€ë¹„ ì¤‘ì— ìˆëŠ” í¥ë¯¸ë¡œìš´ ì¼ë„ ë§ê³ ìš”. ì•„ì‹œë‹¤ì‹œí”¼, ëª¨ë¸ 3ì´ ì¶œì‹œ ì˜ˆì •ì´ê³ ìš”.&rsquo;, &lsquo;ì˜¬í•´ ë§ê¹Œì§€ LAì—ì„œ ë‰´ìš•ê¹Œì§€\nì™„ì „ ììœ¨ ì£¼í–‰ìœ¼ë¡œ íš¡ë‹¨í•˜ëŠ” ê³„íšì— ë§ì¶°ì„œ ì§„í–‰ ì¤‘ì´ì—ìš”.\nì‚¬ëŒì´ í…ŒìŠ¬ë¼ì— íƒ€ì„œ ìš´ì „ëŒ€ë¥¼ ì¡ì§€ ì•Šê³  &ldquo;ë‰´ìš•"ì„ ì°ìœ¼ë©´ ê·¸ë¦¬ë¡œ ê°„ë‹¤ëŠ” ë§ì´ë„¤ìš”.&rsquo;, &lsquo;ê¸¸ê²Œ ê°ˆ ê²ƒ ê°™ì§€ëŠ” ì•Šì•„ìš”.\nê·¸ëŸ¬ë„¤ìš”. ì €ëŠ” ìµœëŒ€í•œ ì˜¤ë«ë™ì•ˆ í…ŒìŠ¬ë¼ì— ë¨¸ë¬¼ ìƒê°ì´ì—ìš”.\nê·¸ë¦¬ê³  ì¤€ë¹„ ì¤‘ì— ìˆëŠ” í¥ë¯¸ë¡œìš´ ì¼ë„ ë§ê³ ìš”. ì•„ì‹œë‹¤ì‹œí”¼, ëª¨ë¸ 3ì´ ì¶œì‹œ ì˜ˆì •ì´ê³ ìš”.&rsquo;, &lsquo;ì˜¬í•´ ë§ê¹Œì§€ LAì—ì„œ ë‰´ìš•ê¹Œì§€\nì™„ì „ ììœ¨ ì£¼í–‰ìœ¼ë¡œ íš¡ë‹¨í•˜ëŠ” ê³„íšì— ë§ì¶°ì„œ ì§„í–‰ ì¤‘ì´ì—ìš”.\nì‚¬ëŒì´ í…ŒìŠ¬ë¼ì— íƒ€ì„œ ìš´ì „ëŒ€ë¥¼ ì¡ì§€ ì•Šê³  &ldquo;ë‰´ìš•"ì„ ì°ìœ¼ë©´ ê·¸ë¦¬ë¡œ ê°„ë‹¤ëŠ” ë§ì´ë„¤ìš”.']</p>
</blockquote>
</li>
<li>RAGë¥¼ ì‚¬ìš©í•  ë•Œì˜ ëŒ€ë‹µ
<blockquote>
<p>ì €ëŠ” í…ŒìŠ¬ë¼ë¥¼ ë§¤ìš° ê¸ì •ì ìœ¼ë¡œ ìƒê°í•©ë‹ˆë‹¤. í…ŒìŠ¬ë¼ëŠ” í˜ì‹ ì ì¸ ê¸°ìˆ ê³¼ ì§€ì† ê°€ëŠ¥í•œ ë¯¸ë˜ë¥¼ ìœ„í•œ ë¹„ì „ì„ ê°–ì¶˜ ê¸°ì—…ìœ¼ë¡œì„œ, ììœ¨ ì£¼í–‰ ê¸°ìˆ ì„ í†µí•´ ìš°ë¦¬ì˜ ì‚¶ì„ í˜ì‹ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì „ê¸°ì°¨ ì‹œì¥ì„ ì„ ë„í•˜ê³  í™˜ê²½ì— ì¹œí™”ì ì¸ ì°¨ëŸ‰ì„ ì œê³µí•˜ëŠ” ë©‹ì§„ ê¸°ì—…ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. í…ŒìŠ¬ë¼ì˜ ë¯¸ë˜ê°€ ë°ê³  í¥ë¯¸ë¡œìš´ ì¼ë“¤ì´ ê³„ì†í•´ì„œ ì¼ì–´ë‚  ê²ƒì´ë¼ê³  ë¯¿ìŠµë‹ˆë‹¤.</p>
</blockquote>
</li>
<li>ê³ ì°°
<blockquote>
<p>í™•ì‹¤íˆ RAGë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•ŒëŠ” ê°ê´€ì ì´ê³  ì¼ë°˜ì ì¸ ëŒ€ë‹µì„ í•˜ëŠ” ë°˜ë©´, RAGë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” í…ŒìŠ¬ë¼ì— ëŒ€í•´ ê¸ì •ì ì¸ ì¼ë¡  ë¨¸ìŠ¤í¬ì˜ ëŒ€ë‹µê³¼, ììœ¨ì£¼í–‰ ê¸°ìˆ ì„ ì–¸ê¸‰í–ˆë‹¤ëŠ” ê²ƒì„ ë°˜ì˜í•˜ì—¬ ëŒ€ë‹µì„ ìƒì„±í•˜ì˜€ë‹¤.</p>
</blockquote>
</li>
</ul>
</article>
<div id=" meta" class=my-16>
<div>
<div class="flex justify-between w-full text-lg">
<a class="previous mr-5 overflow-ellipsis-bundle hover-bold" href=/til/mogako/mogako24-2-02plan/>
<span class=mx-3>â—€</span>
[ëª¨ê°ì½”24í•˜ê³„] 02 : ê³„íš
</a>
<a class="next ml-5 overflow-ellipsis-bundle hover-bold" href=/til/mogako/mogako24-2-03plan/>
[ëª¨ê°ì½”24í•˜ê³„] 03 : ê³„íš
<span class=mx-3>â–¶</span>
</a>
</div>
</div>
</div>
<div id=comment-box></div>
</section>
</main>
</div>
</body>
</html>