<!doctype html><html>
<head>
<title>Nginxì—ì„œ HTTPS ì„¤ì •í•˜ê¸°</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="ë°°ê²½  í…Œì»¤ ë¶€íŠ¸ìº í”„ë¥¼ ì§„í–‰ì¤‘ì´ë‹¤. ëª¨ë“  í”„ë¡œê·¸ë¨ì€ docker-composeë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. AWS EC2ì— êµ¬ë™ ì¤‘ì¸ ì„œë²„ì— HTTPSë¥¼ ì ìš©í•˜ë ¤ê³  í•œë‹¤. ë„ë©”ì¸ êµ¬ë§¤ ì—†ì´  â€¦">
<meta property="og:site_name" content="bong-u/til">
<meta property="og:title" content="Nginxì—ì„œ HTTPS ì„¤ì •í•˜ê¸°">
<meta property="og:description" content="ë°°ê²½  í…Œì»¤ ë¶€íŠ¸ìº í”„ë¥¼ ì§„í–‰ì¤‘ì´ë‹¤. ëª¨ë“  í”„ë¡œê·¸ë¨ì€ docker-composeë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. AWS EC2ì— êµ¬ë™ ì¤‘ì¸ ì„œë²„ì— HTTPSë¥¼ ì ìš©í•˜ë ¤ê³  í•œë‹¤. ë„ë©”ì¸ êµ¬ë§¤ ì—†ì´  â€¦">
<meta property="og:type" content="blog">
<meta property="og:url" content="https://github.com/bong-u/til-hugo">
<meta property="og:image" content="https://bong-u.github.io/til/asset/thumbnail.jpg">
<script type=text/javascript src=https://bong-u.github.io/til/script/base.js></script>
<link rel=icon href=https://bong-u.github.io/til/favicon16.png sizes=16x16>
<link rel=icon href=https://bong-u.github.io/til/favicon32.png sizes=32x32>
<link rel=icon href=https://bong-u.github.io/til/favicon48.png sizes=48x48>
<link rel=icon href=https://bong-u.github.io/til/favicon64.png sizes=64x64>
<link id=twCSS rel=stylesheet href=https://bong-u.github.io/til/css/style.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HE9FQR1ML7"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-HE9FQR1ML7')</script>
</head>
<body class=custom-scroll>
<div class="flex w-full flex-col items-center">
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script>
<script>MathJax={tex:{inlineMath:[['$','$']]}}</script>
<script type=text/javascript src=https://bong-u.github.io/til/script/single.js></script>
<script type=text/javascript src=https://bong-u.github.io/til/script/toc.js></script>
<header class="flex justify-center p-3 w-full text-lg border-b border-line">
<div class="w-full flex justify-between lg-5/6">
<h3>
<a href=https://bong-u.github.io/til/ class=hover-black>
bong-u/til
</a>
</h3>
<div class="flex gap-5">
<a class=hover-black href=https://bong-u.github.io/til/>
ğŸ  home
</a>
<a class=hover-black href=https://github.com/bong-u/til>
ğŸˆ repository
</a>
</div>
</div>
</header>
<input type=checkbox id=toggleDarkMode onchange=toggleDarkModeHandler() hidden>
<main class="w-full lg:w-5/6 px-3 sm:px-12">
<aside class="fixed top-0 right-0 my-24 w-1/6 gap-3 px-9 hidden xl:flex text-sm overflow-hidden">
<nav id=TableOfContents>
<ul>
<li><a href=#ë°°ê²½>ë°°ê²½</a></li>
<li><a href=#ëª©í‘œ>ëª©í‘œ</a></li>
<li><a href=#ë°©ë²•>ë°©ë²•</a>
<ul>
<li></li>
</ul>
</li>
<li><a href=#íšŒê³ >íšŒê³ </a></li>
</ul>
</nav>
</aside>
<section class="my-16 xl:w-5/6">
<div class="mb-8 whitespace-nowrap">
<div class="flex justify-between items-baseline my-4 gap-8">
<h1 id=title class="overflow-ellipsis-bundle text-3xl font-bold p-1">
Nginxì—ì„œ HTTPS ì„¤ì •í•˜ê¸°
</h1>
</div>
</div>
<div class="text-sm flex mb-8 justify-between text-textgray">
<div>
<span class="text-md mr-1">ğŸ·ï¸ nginx</span>
<span class="text-md mr-1">ğŸ·ï¸ https</span>
<span class="text-md mr-1">ğŸ·ï¸ ssl</span>
<span class="text-md mr-1">ğŸ·ï¸ docker</span>
</div>
<h4 id=date>ìˆ˜ì •ì¼ : 2024-11-15</h4>
</div>
<hr class=opacity-30>
<article data-pagefind-body id=content class="bg-inherit markdown-body flex flex-col">
<h2 id=ë°°ê²½>ë°°ê²½</h2>
<ul>
<li>í…Œì»¤ ë¶€íŠ¸ìº í”„ë¥¼ ì§„í–‰ì¤‘ì´ë‹¤.</li>
<li>ëª¨ë“  í”„ë¡œê·¸ë¨ì€ docker-composeë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.</li>
<li>AWS EC2ì— êµ¬ë™ ì¤‘ì¸ ì„œë²„ì— HTTPSë¥¼ ì ìš©í•˜ë ¤ê³  í•œë‹¤.</li>
<li>ë„ë©”ì¸ êµ¬ë§¤ ì—†ì´ ì‹œë„ë¥¼ í–ˆìœ¼ë‚˜, AWSì—ì„œ ì œê³µí•˜ëŠ” ë„ë©”ì¸ìœ¼ë¡œ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ì—†ì—ˆë‹¤.</li>
<li>ë”°ë¼ì„œ, ë„ë©”ì¸ì„ êµ¬ë§¤í•˜ê³ , Route 53ì„ í†µí•´ ë„ë©”ì¸ì„ ì—°ê²°í–ˆë‹¤.</li>
</ul>
<h2 id=ëª©í‘œ>ëª©í‘œ</h2>
<ul>
<li>Nginxë¥¼ ì´ìš©í•˜ì—¬ HTTPSë¥¼ ì ìš©í•œë‹¤.</li>
</ul>
<h2 id=ë°©ë²•>ë°©ë²•</h2>
<h4 id=1-docker-composeymlì—-certbot-ì»¨í…Œì´ë„ˆë¥¼-ì¶”ê°€í•œë‹¤>1. docker-compose.ymlì— certbot ì»¨í…Œì´ë„ˆë¥¼ ì¶”ê°€í•œë‹¤.</h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#f92672>certbot</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>certbot/certbot</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>certbot</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>    <span style=color:#f92672>volumes</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>        - <span style=color:#ae81ff>./certbot/conf:/etc/letsencrypt</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>        - <span style=color:#ae81ff>./certbot/www:/var/www/certbot</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>    <span style=color:#f92672>depends_on</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>        - <span style=color:#ae81ff>nginx</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    <span style=color:#75715e># certbotì„ ë¬´í•œë£¨í”„ë¡œ ëŒë¦¬ê¸° ìœ„í•´ ì‚¬ìš©</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>    <span style=color:#f92672>entrypoint</span>: <span style=color:#e6db74>&#34;/bin/sh -c &#39;trap exit TERM; while :; do sleep 6h &amp; wait $${!}; done;&#39;&#34;</span>
</code></pre></div><h4 id=2-nginxconfë¥¼-ìˆ˜ì •í•œë‹¤>2. nginx.confë¥¼ ìˆ˜ì •í•œë‹¤.</h4>
<pre tabindex=0><code class=language-conf data-lang=conf># certbotì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •
location /.well-known/acme-challenge/ {
    allow all;
    root /var/www/certbot;
}
</code></pre><h4 id=3-certbot-ì»¨í…Œì´ë„ˆë¥¼-í™œìš©í•´ì„œ-ssl-ì¸ì¦ì„œë¥¼-ë°œê¸‰ë°›ëŠ”ë‹¤>3. certbot ì»¨í…Œì´ë„ˆë¥¼ í™œìš©í•´ì„œ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ëŠ”ë‹¤.</h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>docker exec -it certbot certbot certonly <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span style=color:#ae81ff></span>  <span style=color:#75715e># ì›¹ ë£¨íŠ¸ ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì„œë¥¼ ìƒì„±</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>  --webroot <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#ae81ff></span>  <span style=color:#75715e># ì›¹ ì„œë²„ì˜ ì›¹ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ ê²½ë¡œë¥¼ ì§€ì •</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>  --webroot-path<span style=color:#f92672>=</span>/var/www/certbot <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span style=color:#ae81ff></span>  <span style=color:#75715e># ì¸ì¦ì„œ ê°±ì‹  ë° ì¤‘ìš”í•œ ì•Œë¦¼ì„ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì§€ì •</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>  --email <span style=color:#f92672>{</span>ì´ë©”ì¼ ì£¼ì†Œ<span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#ae81ff></span>  <span style=color:#75715e># Let&#39;s Encrypt ì„œë¹„ìŠ¤ ì•½ê´€ì— ë™ì˜</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>  --agree-tos <span style=color:#ae81ff>\ </span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>  <span style=color:#75715e># EFF(Electronic Frontier Foundation) ë‰´ìŠ¤ë ˆí„°ë¥¼ ë°›ì§€ ì•Šë„ë¡ ì„¤ì •</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>  --no-eff-email <span style=color:#ae81ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span style=color:#ae81ff></span>  <span style=color:#75715e># SSL ì¸ì¦ì„œë¥¼ ìƒì„±í•  ë„ë©”ì¸ ì´ë¦„ì„ ì§€ì •</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>  -d <span style=color:#f92672>{</span>ë„ë©”ì¸ ì´ë¦„<span style=color:#f92672>}</span>
</code></pre></div><h4 id=4-nginx-ì›¹-ì„œë²„ì™€-í•¨ê»˜-ì‚¬ìš©í• -ssl-ì„¤ì •-íŒŒì¼ì„-ë‹¤ìš´ë¡œë“œ>4. Nginx ì›¹ ì„œë²„ì™€ í•¨ê»˜ ì‚¬ìš©í•  SSL ì„¤ì • íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ</h4>
<ul>
<li>ë‹¤ìš´ ë°›ì€ í›„ íŒŒì¼ì„ ì•Œë§ì€ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚¨ë‹¤.</li>
<li>í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” /etc/letsencrypt/ë¡œ ì´ë™ì‹œì¼°ë‹¤.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>sudo curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot-nginx/certbot_nginx/_internal/tls_configs/options-ssl-nginx.conf &gt; <span style=color:#e6db74>&#34;./options-ssl-nginx.conf&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>sudo curl -s https://raw.githubusercontent.com/certbot/certbot/master/certbot/certbot/ssl-dhparams.pem &gt; <span style=color:#e6db74>&#34;./ssl-dhparams.pem&#34;</span>
</code></pre></div><h4 id=5-nginxconfë¥¼-ìˆ˜ì •í•œë‹¤>5. nginx.confë¥¼ ìˆ˜ì •í•œë‹¤.</h4>
<ul>
<li>í•„ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ê°€í•˜ì˜€ë‹¤.</li>
</ul>
<pre tabindex=0><code class=language-conf data-lang=conf>server {
    listen 80;
    charset utf-8;

    server_name {ë„ë©”ì¸ ì´ë¦„};

    # HTTP ìš”ì²­ì„ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    location / {
        return 301 https://$host$request_uri;
    }
}
server {
    listen 443 ssl;
    charset utf-8;

    server_name { ë„ë©”ì¸ ì´ë¦„ };

    # SSL ì¸ì¦ì„œ ì„¤ì •
    ssl_certificate /etc/letsencrypt/live/api.forest-of-thoughts.site/fullchain.pem;
    # SSL ì¸ì¦ì„œ í‚¤ ì„¤ì •
    ssl_certificate_key /etc/letsencrypt/live/api.forest-of-thoughts.site/privkey.pem;
    # SSL ì„¤ì • íŒŒì¼ í¬í•¨
    include /etc/letsencrypt/options-ssl-nginx.conf;
    # Diffie-Hellman í‚¤ ì„¤ì •
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}
</code></pre><h4 id=6-nginx-ì»¨í…Œì´ë„ˆ-ì„¤ì •ì„-ìˆ˜ì •í•œë‹¤>6. nginx ì»¨í…Œì´ë„ˆ ì„¤ì •ì„ ìˆ˜ì •í•œë‹¤.</h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#f92672>nginx</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:stable</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>    <span style=color:#f92672>ports</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>        - <span style=color:#e6db74>&#34;80:80&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>        - <span style=color:#e6db74>&#34;443:443&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>    <span style=color:#f92672>volumes</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>        - <span style=color:#ae81ff>./nginx.conf:/etc/nginx/nginx.conf</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>        - <span style=color:#ae81ff>./certbot/conf:/etc/letsencrypt</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span>        - <span style=color:#ae81ff>./certbot/www:/var/www/certbot</span>
</code></pre></div><p>í•´</p>
<h2 id=íšŒê³ >íšŒê³ </h2>
<ul>
<li>ë³´í†µ crontabì„ í™œìš©í•´ì„œ ìë™ìœ¼ë¡œ ì¸ì¦ì„œ ê°±ì‹ ì„ ë°›ëŠ”ë‹¤.</li>
<li>ì´ë²ˆì—ëŠ” í”„ë¡œì íŠ¸ ê¸°ê°„ì´ ê¸¸ì§€ ì•Šì•„ì„œ, ìˆ˜ë™ìœ¼ë¡œ ì§„í–‰í–ˆë‹¤.</li>
<li>ë‹¤ìŒì—ëŠ” ìë™ìœ¼ë¡œ ì¸ì¦ì„œ ê°±ì‹ ì„ ë°›ëŠ” ê²ƒë„ ë„ì „í•´ë³´ì.</li>
</ul>
</article>
<div id=" meta" class=my-16>
<div>
<div class="flex justify-between w-full text-lg">
<a class="previous mr-5 overflow-ellipsis-bundle hover-bold" href=/til/devtools/git_submodule/>
<span class=mx-3>â—€</span>
Git - Submodule
</a>
</div>
</div>
</div>
<div id=comment-box></div>
</section>
</main>
</div>
</body>
</html>